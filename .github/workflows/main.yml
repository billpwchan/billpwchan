# Licensed under The Unlicense
# GitHub Metrics Auto-Update Workflow
# Stable and scope-aware configuration for profile metrics

name: Metrics

on:
  schedule:
    - cron: "59 1 * * *"
  workflow_dispatch:

concurrency:
  group: metrics-generation
  cancel-in-progress: false

jobs:
  metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      USERNAME: billpwchan
      METRICS_TOKEN: ${{ secrets.METRICS_TOKEN != '' && secrets.METRICS_TOKEN || github.token }}
      STOCK_TOKEN: ${{ secrets.STOCK_TOKEN }}
    steps:
      - name: üóÉÔ∏è Base Metrics - Core Stats & Activity
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/base.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: header, activity, community, repositories
          plugin_lines: yes

      - name: üà∑Ô∏è Language Distribution - Programming Focus
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/languages.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_languages: yes
          plugin_languages_analysis_timeout: 30
          plugin_languages_categories: programming
          plugin_languages_colors: github
          plugin_languages_ignored: >-
            html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell,
            gnuplot, tcl, jupyter%20notebook
          plugin_languages_limit: 8
          plugin_languages_sections: most-used
          plugin_languages_threshold: 0%
          plugin_languages_details: bytes-size, percentage

      - name: üìÖ Isometric Commit Calendar - Half-Year View
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/isocalendar.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: half-year

      - name: üì∞ Recent Activity - Latest Contributions
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/activity.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_activity: yes
          plugin_activity_limit: 6
          plugin_activity_days: 14
          plugin_activity_filter: issue, pr
          plugin_activity_visibility: public

      - name: üí° Coding Habits - Development Patterns
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/habits.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_habits: yes
          plugin_habits_charts: yes
          plugin_habits_days: 30

      - name: üèÜ Achievements - GitHub Milestones
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/achievements.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_achievements: yes
          plugin_achievements_display: compact
          plugin_achievements_threshold: C

      - name: ‚ú® Stargazers - Repository Growth
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/stargazers.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_stargazers: yes
          plugin_stargazers_charts_type: classic

      - name: üé≠ Comment Reactions - Community Interaction
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/reactions.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_reactions: yes
          plugin_reactions_limit: 100
          plugin_reactions_details: percentage

      - name: üóÇÔ∏è Featured Repositories - Top Projects
        if: ${{ always() }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/projects.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_repositories: yes
          plugin_repositories_featured: billpwchan/futu_algo
          plugin_repositories_order: stars

      - name: üíπ Stock Prices - Market Data
        if: ${{ always() && env.STOCK_TOKEN != '' }}
        uses: lowlighter/metrics@v3
        with:
          filename: asset/stock.svg
          token: ${{ env.METRICS_TOKEN }}
          user: ${{ env.USERNAME }}
          base: ""
          plugin_stock: yes
          plugin_stock_token: ${{ env.STOCK_TOKEN }}
          plugin_stock_symbol: MS
          plugin_stock_duration: 5d
          plugin_stock_interval: 5m
